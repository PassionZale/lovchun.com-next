---
title: '构建 Vue3 组件库 - 如何开始'
createdAt: '2023-11-22'
publishedAt: '2023-12-31'
updatedAt: '2023-11-22'
toc: false
draft: false
summary: '在开始编码前，先聊聊会面临的问题，需要克服的难点。'
tags: ['指南', 'Vue.js']
components: ['Tree']
---

10.13 - 11.10，花费了尽一个月的时间，完成了 [`Geist Design`](https://geist-design.lovchun.com/) 整套组件库的搭建。

~~直到现在单元测试还没开始写。~~

在编码开始之前，我还花费了数个月的时间调研和尝试了几套构建库的模式，期间遇到了许多问题，诸如：

- 采用哪种模式搭建项目；
- `lint` 要怎么做；
- `ts+vue` 要怎么配置；
- 如何搭建和部署文档；
- 如何设计组件的目录结构；
- 开发时如何调试组件；
- 如何处理组件所需要的 icons；
- 如何处理组件的样式；
- 如何构建和发布组件库；
- ...

## 项目搭建

> **monolith** **multirepo** **monorepo** 到底该选哪一个？

网上铺天盖地的文章，不约而同的推荐你使用 `monorepo` + `pnpm workspace` 来构建一个组件库：

<Tree data={MonoRepoStructure} />

对于 `pnpm` **零经验** 的小伙伴来讲，你可能需从 [文档](https://pnpm.io/zh/installation) 开始学习一下 `pnpm`，

然后你又会遇到一系列的问题：

- 什么场景需要将 `package.json` 的 `private` 设置为 true / false；
- `pnpm --filter`；
- `pnpm --recursive --parallel --stream run **`；
- `pnpm@7` `pnpm@8` 版本怎么控制；
- `shamefully-hoist` `auto-install-peers` `strict-peer-dependencies` 怎么设置；
- 为什么有的库需要装到根目录，有的需要安装到指定的 `workspace`；
- ...

**你真的需要 monorepo 吗？**

**你真的会持续的维护组件库吗？**

**你真的会持续的构建组件库相关生态吗？**

**你真的会持续的解决 issue 吗？**

**真的会有人使用你的组件库吗？**

在调研期间，我购买了一本小册 [《基于 Vite 的组件库工程化实战》](https://s.juejin.cn/ds/iRCGnt8v/)，评论下面，学员各种环境问题颇多，这个跑不起来，那个不生效的比比皆是。

能跟着把小册啃完，而后折腾出成果的不多，在 [🚀 学员优秀实践汇总](https://github.com/smarty-team/smarty-admin/issues/17) 中，大部分学员们的成果，基本就是写了 `<Button />`，而后发布一次 `npm`，就结束了。

其中最健壮的 [`Fighting Design`](https://github.com/FightingDesign/fighting-design)，我从这个仓库借鉴了许多，如 `eslint` `utils` `props` 等，这是一个非常棒的仓库，如果你仍然想用 monorepo 试试，可以参考它，当然 [`element-plus`](https://github.com/element-plus/element-plus) 也是个不错的选择。

<Image
  src="/static/images/setup-vue3-component-library/i-want-easy-to-play.jpg"
  alt={'i-want-easy-to-play'}
  width={218}
  height={72}
/>

如我同事说的那样，我只想简单的开始编码，

export const MonoRepoStructure = [
  {
    type: 'folder',
    name: 'docs',
    help: '组件文档'
  },
  {
    type: 'folder',
    name: 'play',
    help: '组件调试'
  },
  {
    type: 'folder',
    name: 'packages',
    expand: true,
    childrens: [
      { type: 'folder', name: 'eslint-config', help: 'lint' },
      { type: 'folder', name: 'theme-chalk', help: '样式' },
      { type: 'folder', name: 'components', help: '组件源码' },
      { type: 'folder', name: 'hooks', help: '自定义 composable api' },
      { type: 'folder', name: 'utils', help: '一些工具模块等...' },
    ]
  },
  {
    type: 'folder',
    name: 'scripts',
    help: '存放脚本'
  },
  {
    type: 'file',
    name: '.eslintrc',
    icon: 'config'
  },
  {
    type: 'file',
    name: '.prettierrc',
    icon: 'config'
  },
  {
    type: 'file',
    name: 'pnpm-workspace.yaml',
    icon: 'config',
    help: 'docs, paly, pacakges/*'
  },
  {
    type: 'file',
    name: 'package.json'
  }
]