---
title: 'Setup Miniprgram - PART 2'
createdAt: '2022-07-01'
publishedAt: '2022-07-02'
updatedAt: '2022-07-02'
draft: false
summary: 'è‡ªå®šä¹‰å¼‚å¸¸ã€é€šè®¯ã€ç¼“å­˜ã€SDK å°è£…'
tags: ['guide']
---

<Image
  src={'/static/images/setup-miniprogram/banner.jpeg'}
  width={1417}
  height={667}
  alt="æ¶æ„ã€æ¡†æ¶ã€ç»„ä»¶"
/>

> - [ã€ŠSetup Miniprgram - PART 1ã€‹](/posts/setup-miniprogram/part-1)
>
>   - VSCode æ’ä»¶ã€ç›®å½•è®¾è®¡ã€å¾®ä¿¡å¼€å‘è€…å·¥å…·ã€é…ç½®æ–‡ä»¶ã€Packages
>
> - :rainbow: [ã€ŠSetup Miniprgram - PART 2ã€‹](/posts/setup-miniprogram/part-2)
>
>   - å¼‚å¸¸ã€é€šè®¯ã€ç¼“å­˜ã€SDK å°è£…
>
> - [ã€ŠSetup Miniprgram - PART 3ã€‹](/posts/setup-miniprogram/part-3)
>
>   - TODO
>
> - [ã€ŠSetup Miniprgram - PART 4ã€‹](/posts/setup-miniprogram/part-4)
>
>   - TODO
>
> - [ã€ŠSetup Miniprgram - PART 5ã€‹](/posts/setup-miniprogram/part-5)
>   - TODO

## å¼‚å¸¸

è”è°ƒæ¥å£æ—¶ï¼Œé€šå¸¸åç«¯ä¼šæœ‰ä¸€å¥—é€šç”¨çš„ `ResponseDTO`:

```ts
interface IBaseResponse<T = any> {
  /**
   * ä¸šåŠ¡çŠ¶æ€ç 
   */
  code: number
  /**
   * å“åº”æ•°æ®
   */
  data: T
  /**
   * å“åº”æ¶ˆæ¯
   */
  message: string
  /**
   * å“åº”æ—¶é—´æˆ³
   */
  timestamp: number
  /**
   * è‡ªå®šä¹‰å±æ€§ï¼Œå¦‚: path: string
   */
  [propName: string]: any
}
```

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šæœ‰æŸäº›åœºæ™¯ï¼ŒæœŸæœ› `Promise` æˆ–è€… `async function` æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼š

```js
throw new Error('è¯·æ±‚å¤±è´¥')
// æˆ–
return Promise.reject('è¯·æ±‚å¤±è´¥')
```

ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´æˆ‘ä»¬è‡ªå®šä¹‰çš„å¼‚å¸¸å’Œ API çš„è¿”å›æ•°æ®ç»“æ„ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å°è£…ä¸€ä¸ª**è‡ªå®šä¹‰å¼‚å¸¸**è¿›è¡Œç»Ÿä¸€:

### CustomException

```js
const EXCEPTION_ERROR_MESSAGE = 'ç½‘ç»œå¼€å°å·®~'

/**
 * è‡ªå®šä¹‰å¼‚å¸¸, æ•°æ®ç»“æ„ä¸ IBaseResponse ç›¸ä¼¼
 * {
 *  "code": => å¯é€‰å­—æ®µï¼Œé 200 çš„æ•´æ•°ï¼Œé»˜è®¤ä¸º 5000
 *  "data": => å¯é€‰å­—æ®µï¼Œç”¨äºè‡ªå®šä¹‰æ•°æ®
 *  "message" => å¿…å¡«å­—æ®µï¼Œç”¨äºé”™è¯¯åŸå› è¯´æ˜
 *  "timestamp" => é»˜è®¤å¡«å…… å½“å‰æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
 *  "name" => é»˜è®¤å¡«å…… 'CustomException'
 * }
 */
class CustomException {
  constructor({ code = 5000, data, message }) {
    this.code = code
    this.data = data
    this.message = message || EXCEPTION_ERROR_MESSAGE
    this.timestamp = +new Date()
    this.name = 'CustomException'
  }
}

// âœ…
throw new CustomException({ message: 'è‡ªå®šä¹‰é”™è¯¯' })
// âŒ
throw new Error('è¯·æ±‚å¤±è´¥')
```

### SDKException

ä½¿ç”¨å°ç¨‹åº SDK æ—¶ï¼ŒSDK æ‰€ç»™çš„ `error` æ˜¯è¿™æ ·çš„:

```json
{
	"errMsg": "openBluetoothAdapter:fail:not available",
	"errCode": 10001,
	"errno": 1500102
}
```

å’Œ `IBaseResponse` åˆæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å°è£…ä¸€ä¸ª**SDK å¼‚å¸¸**è¿›è¡Œç»Ÿä¸€:

```js
const EXCEPTION_ERROR_MESSAGE = 'ç½‘ç»œå¼€å°å·®~'

/**
 * è‡ªå®šä¹‰å¾®ä¿¡æˆ–ä¼å¾® SDK å¼‚å¸¸
 * https://developers.weixin.qq.com/miniprogram/dev/framework/usability/PublicErrno.html
 * {
 *  "errMsg": "openBluetoothAdapter:fail:not available",
 *  "errCode": 10001,
 *  "errno": 1500102,
 *  "code": => å¯é€‰å­—æ®µï¼Œé 200 çš„æ•´æ•°ï¼Œè‹¥è®¾ç½®äº†å€¼ï¼Œ"errno" å’Œ "errCode" ä¼šå¤±æ•ˆ
 *  "data": => å¯é€‰å­—æ®µï¼Œç”¨äºè‡ªå®šä¹‰æ•°æ®
 *  "message": => å¯é€‰å­—æ®µï¼Œç”¨äºæ•è·å…¶ä»– js é”™è¯¯ï¼Œæˆ–è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯
 *  "timestamp" => é»˜è®¤å¡« å……å½“å‰æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
 *  "name" => é»˜è®¤å¡«å…… 'SDKException'
 * }
 */
class SDKException {
  constructor({ errMsg, errCode, errno, code, message, data }) {
    this.code = code || errno || errCode || 5000
    this.data = data
    this.message = message || errMsg || EXCEPTION_ERROR_MESSAGE
    this.timestamp = +new Date()
    this.name = 'SDKException'
  }
}
```

### å¼‚å¸¸æ¥æº

**é€šè¿‡`instanceof`åˆ¤æ–­ï¼ˆğŸ‘ æ¨èï¼‰**

```js
async function foo() {
  try {
    await bar()
  } catch (exception) {
    if (exception instanceof CustomException) {
      // æ˜¯æˆ‘çš„è‡ªå®šä¹‰å¼‚å¸¸
    } else {
      // ä¸æ˜¯æˆ‘çš„è‡ªå®šä¹‰å¼‚å¸¸ <= Uncaught ReferenceError: bar is not defined
    }
  }
}
```

**é€šè¿‡`name`åˆ¤æ–­**

```js
async function foo() {
  try {
    await bar()
  } catch (exception) {
    if (exception.name === 'CustomException') {
      // æ˜¯æˆ‘çš„è‡ªå®šä¹‰å¼‚å¸¸
    } else {
      // ä¸æ˜¯æˆ‘çš„è‡ªå®šä¹‰å¼‚å¸¸ <= Uncaught ReferenceError: bar is not defined
    }
  }
}
```

### :zap: é¢å¤–å°å¿ƒ

å°ç¨‹åºçš„ SDK æ¯”è¾ƒä¼šè¿”å›æ‰€æœ‰çš„é”™è¯¯ï¼Œ**åŒ…æ‹¬å–æ¶ˆ**ï¼Œåœ¨æ•è· `SDKException` éœ€è¦è¿‡æ»¤æ‰è¿™ç±»åœºæ™¯:

```js {12,13}
/**
 * æ‹¨æ‰“ç”µè¯
 * @param {string} phoneNumber ç”µè¯å·ç 
 */
export async function makePhoneCall(phoneNumber) {
  if (typeof phoneNumber !== 'string')
    throw new SDKException({ message: 'phoneNumber must be string' })

  try {
    await wx.makePhoneCall({ phoneNumber })
  } catch (error) {
    // exclude "å–æ¶ˆ" çš„åœºæ™¯
    if (!error.errMsg || error.errMsg.indexOf('fail cancel') === -1) {
      wx.showToast({ title: error.errMsg, icon: 'none' })

      throw new SDKException(error)
    }
  }
}
```

## é€šè®¯

**pageA** `navigateTo` **pageB**

### query ä¼ å‚

```js:pageA.js
Page({
  methods: {
    handleTap() {
      wx.navigateTo({ url: `pageB?foo=bar` })
    }
  }
})
```

## æŠ€å·§

### å®‰å…¨åŒºé€‚é…

TODO

### Page Enhance

TODO

### ç»„ä»¶æ›å…‰

TODO

### input æ ·å¼