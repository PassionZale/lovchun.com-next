---
title: 'Setup Miniprgram - Gulp Tasks'
createdAt: '2022-07-01'
publishedAt: '2022-07-03'
updatedAt: '2022-07-03'
toc: true
draft: false
summary: ''
tags: ['guide']
---

import Tree from '@/components/MDXComponents/Tree'
import { RiAlarmWarningLine } from 'react-icons/ri'

<Image
  src={'/static/images/setup-miniprogram/banner.jpeg'}
  width={1417}
  height={667}
  alt="架构、框架、组件"
/>

> - [《Setup Miniprgram - 插件、目录结构、开发者工具、配置、Packages》](/posts/setup-miniprogram/part-1)
>
>   - 插件、目录结构、开发者工具、配置、Packages
>
> - [《Setup Miniprgram - 异常、通讯、技巧》](/posts/setup-miniprogram/part-2)
>
>   - 异常、通讯、技巧
>
> - :rainbow: [《Setup Miniprgram - Gulp Tasks》](/posts/setup-miniprogram/part-3)
>
>   - Gulp Tasks
>
> - [《Setup Miniprgram - PART 4》](/posts/setup-miniprogram/part-4)
>
>   - TODO
>
> - [《Setup Miniprgram - PART 5》](/posts/setup-miniprogram/part-5)
>   - TODO

## Gulp

市面上有许多小程序开发框架: wepy/mpvue/taro/uni-app 等等...

选原生开发还是第三方框架，一直是个很纠结的问题。

### 原生开发

- 原生开发对 Node、预编译器、环境变量等支持很差，影响开发效率和工程构建流程；
- 小程序定义了一套新的语法、标签、内置组件，需要一定的学习成本；
- 生态差，很多时候都需要从零手写，没有太多好用的第三方库；

### 第三方框架

- 担心性能不如原生；
- 担心有些功能框架实现不了，只能用原生；
- 担心框架不稳定，比原生的坑还多；

### 如何取舍

- 项目很大，页面数量 30+；
- 交互复杂；
- 需要同时在企微和微信中运行；
- 不考虑其他平台；

**满足这四点，建议直接使用原生开发。**

针对原生开发，为了提高开发效率，首先需要做的就是挑选一个构建工具。

不论第三方框架是基于 `Vuejs` 还是 `React`，整个构建过程，它们都在干同一件事情：

> **将代码转换成小程序所约定的文件和目录**

```shell
# 转换 wxss
css/less/scss/stylus => wxss
# 转换 wxml
jsx/template => wxml
# 转换 标签
html dom => <view/>、<text />、<scroll-view />、etc...
# 转换 语法
ES6 => ES5
```

### 小程序目录特色

小程序中，不论是组件还是页面，通常都由四种文件组成:

| 文件类型 |  必须  | 说明 |
| :------- | :----: | :--: |
| wxml     | **是** | 视图 |
| wxss     |   否   | 样式 |
| js       | **是** | 脚本 |
| json     | **是** | 配置 |

<Tree data={MiniprgramFolderData} />

## 目录结构

<Tree data={structure} />

export const MiniprgramFolderData = [
  {
    type: 'folder',
    name: 'indexPage',
    childrens: [
      { type: 'file', name: 'indexPage.js' },
      { type: 'file', name: 'indexPage.json' },
      { type: 'file', name: 'indexPage.wxss' },
      { type: 'file', name: 'indexPage.wxml' },
    ],
  },
  {
    type: 'folder',
    name: 'indexComponent',
    childrens: [
      { type: 'file', name: 'indexComponent.js' },
      { type: 'file', name: 'indexComponent.json' },
      { type: 'file', name: 'indexComponent.wxss' },
      { type: 'file', name: 'indexComponent.wxml' },
    ],
  },
]

export const structure = [
  {
    type: 'folder',
    name: 'scripts',
    expand: true,
    childrens: [
      {
        type: 'folder',
        name: 'generator',
        expand: true,
        help: '生成器：创建组件、页面、分包等',
        childrens: [
          {
            type: 'folder',
            name: 'tmp',
            expand: true,
            childrens: [
              {
                type: 'folder',
                name: 'component',
                help: '组件模板',
                childrens: [
                  { type: 'file', name: 'tpl.js' },
                  { type: 'file', name: 'tpl.json' },
                  { type: 'file', name: 'tpl.md' },
                  { type: 'file', name: 'tpl.scss' },
                  { type: 'file', name: 'tpl.wxml' },
                ],
              },
              {
                type: 'folder',
                name: 'page',
                help: '页面模板',
                childrens: [
                  { type: 'file', name: 'tpl.js' },
                  { type: 'file', name: 'tpl.json' },
                  { type: 'file', name: 'tpl.scss' },
                  { type: 'file', name: 'tpl.wxml' },
                ],
              },
            ],
          },
          { type: 'file', name: 'index.js' },
        ],
      },
      {
        type: 'folder',
        name: 'gulp',
        expand: true,
        help: 'Gulp 任务',
        childrens: [
          {
            type: 'folder',
            name: 'tasks',
            childrens: [
              {
                type: 'file',
                name: 'clean.task.js',
                icon: 'js',
                help: 'clean ./dist or ./build',
              },
              {
                type: 'file',
                name: 'js.task.js',
                icon: 'js',
                help: 'migrate ./src/**/*.js',
              },
              {
                type: 'file',
                name: 'json.task.js',
                icon: 'js',
                help: 'migrate ./src/**/*.json',
              },
              {
                type: 'file',
                name: 'others.task.js',
                icon: 'js',
                help: 'migrate ./src/**/*.!(scss|wxss|js|wxs|json|wxml|md)',
              },
              {
                type: 'file',
                name: 'projectBuild.task.js',
                icon: 'js',
                help: '打包构建时，以 _project.config.json 创建 project.config.json',
              },
              {
                type: 'file',
                name: 'projectMake.task.js',
                icon: 'js',
                help: '开发运行时，对比 project.config.json 判断是否要重新创建',
              },
              {
                type: 'file',
                name: 'scss.task.js',
                icon: 'js',
                help: 'migrate ./src/**/*.scss',
              },
              {
                type: 'file',
                name: 'watch.task.js',
                icon: 'js',
                help: '开发运行时文件变化监听',
              },
              {
                type: 'file',
                name: 'wxml.task.js',
                icon: 'js',
                help: 'migrate ./src/**/*.wxml',
              },
              {
                type: 'file',
                name: 'wxs.task.js',
                icon: 'js',
                help: 'migrate ./src/**/*.wxs',
              },
              {
                type: 'file',
                name: 'wxss.task.js',
                icon: 'js',
                help: 'migrate ./src/**/*.wxss',
              },
              {
                type: 'file',
                name: 'zip.task.js',
                icon: 'js',
                help: './build => ${buildId}.zip',
              },
            ],
          },
          {
            type: 'file',
            name: 'context.js',
            help: 'gulp runtime 时的上下文',
          },
        ],
      },
      {
        type: 'folder',
        name: 'lib',
        help: '一些辅助函数或类库',
        childrens: [{ type: 'file', name: '**/*.js' }],
      },
    ],
  },
  { type: 'file', name: 'gulpfile.js', icon: 'gulp' },
  { type: 'file', name: '.npmrc', icon: 'npm' },
  { type: 'file', name: 'package.json' },
  {
    type: 'file',
    name: '_project.config.json',
    help: (
      <div className="flex items-center text-red-500 underline decoration-red-500">
        <RiAlarmWarningLine />
        注意文件名
      </div>
    ),
  },
]
